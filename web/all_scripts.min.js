function get_component_id(e){return e in main_components_ids?main_components_ids[e]:3}function reset_force(e,t){null!==force&&(force.stop(),force.nodes(null),force.links(null),force.resume(),force.stop(),force.nodes(e),force.links(t),force.start())}function range(e,t){return Array.apply(0,Array(t)).map(function(t,l){return l+e})}function play_stop_forces(){is_force_running?(is_force_running=!1,force.stop()):(is_force_running=!0,force.start())}function changeForceParameters(){force.linkDistance(d3.select("#distance").node().value),force.friction(d3.select("#friction").node().value),force.linkStrength(d3.select("#strength").node().value),force.start()}function handleFileIIS(e){$(document).ready(function(){loadDiagram(e,loadNetwork,!0)})}function handleFileSelect(e){$(document).ready(function(){try{$("#loading-container").css("display","block");for(var t,l=e.target.files,n=0;t=l[n];n++)if(loadDiagram(t,loadNetwork,!1),1==n){alert("Select only one XGMML file.");break}}catch(e){console.log(e.message)}})}function collide(e){return function(t){var l=null;l=globalkeepEnabled?d3.selectAll(".node").filter(function(e){return e.visible}).data():d3.selectAll(".node").data();var n=2*radius+padding;d3.geom.quadtree(l).visit(function(l,a,r,o,i){if(l.point&&l.point!==t){var s=t.x-l.point.x,c=t.y-l.point.y,d=Math.sqrt(s*s+c*c);d<n&&(d=(d-n)/d*e,t.x-=s*=d,t.y-=c*=d,l.point.x+=s,l.point.y+=c)}return a>t.x+n||o<t.x-n||r>t.y+n||i<t.y-n})}}function changeSelectedCC(e,t,l){var n=t.attributes["Selected CC"].value.replace(/ /g,"_"),a=l.replace(/ /g,"_");t.attributes["Selected CC"].value=a.replace(/_/g," "),"cell_surface"==a?a="extracellular":a in cell&&""!==a&&null!==a||(console.log(a+"is not in cell, placing in cytoplasm instead."),a="cytoplasm"),t.group=t.attributes[d3.select("#color").node().value].value,t.component=a,t.component_id=get_component_id(a),t.attributes["Changed Selected CC"]={type:"boolean",value:!0},a in selected_cc_count?selected_cc_count[a]=selected_cc_count[a]+1:selected_cc_count[a]=1,n in selected_cc_count&&(selected_cc_count[n]=selected_cc_count[n]-1),update_valid_ccs_for_diagram(e),remove_unused_organelles(),updateColor(),updateDonutChart()}function convertToCellNetVisCC(e){if("unknown"==e||""==e||null==e)return"not_found";if(e in cell)return e;for(var t in cell)if(cell.hasOwnProperty(t)&&(t.indexOf(e)>=0||e.indexOf(t)>=0))return t;return e.indexOf(!1)?"extracellular":e.indexOf("endoplas")>=0?"endoplasmic_reticulum":e.indexOf("golgi")>=0?"golgi_apparatus":e.indexOf("mitocho")>=0?"mitochondrion":e.indexOf("nucle")>=0?"nucleus":e.indexOf("glycos")>=0?"glycosome":e.indexOf("glyox")>=0?"glyoxysome":e.indexOf("endoso")>=0?"endosome":e.indexOf("plast")>=0?"plastid":e.indexOf("lyso")>=0?"lysosome":e.indexOf("perox")>=0?"peroxisome":e.indexOf("tubule")>=0?"microtubule_organising_centre":e.indexOf("centro")>=0?"centrosome":e.indexOf("amylo")>=0?"amyloplast":e.indexOf("apico")>=0?"apicoplast":e.indexOf("chloro")>=0?"chloroplast":e.indexOf("ext")>=0?"extracellular":e.indexOf("vac")>=0?"vacuole":e.indexOf("membran")>=0?"plasma_membrane":e.indexOf("wall")>=0?"cell_wall":"not_found"}function updateContentTable(e,t){$("#rows").empty();n='<tr><td class="text-left">ID</td>';n+='<td class="text-left">'+t.id.replace("n_","")+"</td>",n+="</tr>",n+='<tr><td class="text-left">Selected CC</td>',n+="<td class='text-left'><select id='updateCCchooser'><option value='"+t.attributes["Selected CC"].value+"'>"+t.attributes["Selected CC"].value.replace(/_/g," ")+"*</option>";for(var l in cell)l!=t.attributes["Selected CC"].value&&(n+="<option value='"+l+"'>"+l.replace(/_/g," ")+"</option>");n+="</td>",n+="</tr>",n+='<tr><td class="text-left">Extracted CCs</td>',n+='<td class="text-left">'+t.attributes["CellNetVis CCs"].value.toString().replace(/_/g," ").replace(/,/g,", ")+"</td>",n+="</tr>",$("#rows").append(n),$(document).ready(function(){$("#updateCCchooser").val(t.attributes["Selected CC"].value),$("#updateCCchooser").change(function(){changeSelectedCC(e,t,this.value)})});for(name in t.attributes)if("selected cc"!=name.toLowerCase()&&"cellnetvis ccs"!=name.toLowerCase()){var n='<tr><td class="text-left">'+name+"</td>";"uniprot id"===name.toLowerCase()||"uniprotid"===name.toLowerCase()||"uniprot_id"===name.toLowerCase()?n+='<td class="text-left"><a  href=\'http://www.uniprot.org/uniprot/'+t.attributes[name].value+"' target='_blank' title='Click opens a new tab.'>"+t.attributes[name].value+" (click to search it at UniProt.org)</a> </td>":n+='<td class="text-left">'+t.attributes[name].value+"</td>",n+="</tr>",$("#rows").append(n)}}function update_valid_ccs_for_diagram(e){for(cc in used_organelles)used_organelles.hasOwnProperty(cc)&&(used_organelles[cc]=!1);used_organelles.plasma_membrane=!0,used_organelles.extracellular=!0,used_organelles.cytoplasm=!0,used_organelles.cytosol=!0,used_organelles.nucleus=!0;for(var t=0;t<e.nodes.length;t++)0==used_organelles[e.nodes[t].attributes["Selected CC"].value.replace(/ /g,"_")]&&(used_organelles[e.nodes[t].attributes["Selected CC"].value.replace(/ /g,"_")]=!0);restartForces()}function deselectNode(e){null!==e&&e.transition().duration(200).attr("r",radius)}function selectNode(e){null!==e&&e.transition().duration(200).attr("r",1.3*radius)}function restartForces(){can_run_forces&&(null===bundling&&remove_edge_bundling(),is_force_running=!0,d3.selectAll(".node").each(function(e){e.fixed=!1}),force.start())}function stopForces(){force.stop(),d3.selectAll(".node").each(function(e){e.fixed=!0}),is_force_running=!1}function constraint_network(e){function t(e){remove_unused_organelles(),d3.selectAll(".group_component").classed("highlight_cc",!1),d3.select("#"+convertToCellNetVisCC(e.attributes["Selected CC"].value.toLowerCase().replace(/ /g,"_"))+"_group").style("visibility","visible").classed("highlight_cc",!0);var t=e.attributes["CellNetVis CCs"].value;cell_wall=!1;for(var l in t){var n=t[l];"cytosol"==n&&(n="cytoplasm"),"cell_wall"==n&&(cell_wall=!0),"not_found"!=n&&d3.select("#"+n+"_group").style("visibility","visible").classed("highlight_cc",!0)}is_force_running?e.fixed=!1:cell_wall&&(e.fixed=!1)}function l(){globalkeepEnabled?d3.selectAll(".node").filter(function(e){return e.visible}).each(function(e){var t,l=cell[e.component];t=o[e.component_id](e,cell,l),e.x=t.x,e.y=t.y}):d3.selectAll(".node").each(function(e){var t,l=cell[e.component];t=o[e.component_id](e,cell,l),e.x=t.x,e.y=t.y}),0!=globalAlpha&&is_force_running&&!dragging&&d3.selectAll(".node").each(collide(globalAlpha)),d3.selectAll(".gnode").attr("transform",function(e){if(!isNaN(e.x)&&!isNaN(e.y))return"translate("+e.x+transform_svg_separator+e.y+")";e.x=e.px,e.y=e.py}),d3.selectAll(".edge").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})}var n=d3.select("#network_group");n.append("g").classed("edges",!0).selectAll("line").data(e.links).enter().append("svg:line").attr("class","edge").attr("id",function(e){return e.id});d3.selectAll("line").attr("stroke","rgba(32,32,32,"+unselectedEdgeDarker+")");var a=d3.behavior.drag().on("dragstart",function(e,t){showing_bundling||null!==bundling||(e.fixed=!0,dragging=!0)}).on("drag",function(e,t){showing_bundling||null!==bundling||(e.x+=d3.event.dx,e.y+=d3.event.dy,e.px=e.x,e.py=e.y,l())}).on("dragend",function(e,t){showing_bundling||null!==bundling||(e.fixed=!0,l(),force.resume(),dragging=!1)});kkkaadaasdwqeq;var r=n.selectAll("g.gnode").data(e.nodes).enter().append("g").attr("id",function(e){return e.id+"_g"}).classed("gnode",!0);r.append("svg:circle").attr("draggable",!0).attr("r",radius-.75).attr("class","node").attr("id",function(e){return e.id}).style("fill",function(e){return scale(e.group)}).style("stroke",function(e){return d3.rgb(scale(e.group)).darker()}).on("mouseover",function(e){d3.select("#label"+e.id).style("visibility","visible")}).on("mouseout",function(e){!1===e.showlabel&&d3.select("#label"+e.id).style("visibility","hidden")}).on("click",function(l){hideAllLabels();var n=l.selected;d3.selectAll(".node").filter(function(e){return e.visible}).style("stroke-width","1px").style("stroke",function(e){return d3.rgb(scale(e.group)).darker()}).style("opacity",.2);var a=d3.selectAll(".node").filter(function(e){return e.visible}).data();for(nd in a)a[nd].selected=!1;if(showing_bundling?d3.selectAll(".bundling").style("stroke","rgb(32,32,32)").style("stroke-opacity",.03):d3.selectAll(".edge").attr("stroke","rgba(32,32,32,"+unselectedEdge+")"),!1===n){l.selected=!0,t(l),thisnode=d3.select("#"+l.id),thisnode.style("stroke-width","2px").style("stroke","#ce6f20"),thisnode.style("opacity",1),d3.select("#label"+l.id).style("visibility","visible"),l.showlabel=!0;for(var r=0;r<e.links.length;r++)if(e.links[r].source.id===l.id)(o=d3.select("#"+e.links[r].target.id)).data()[0].visible&&(o.data()[0].selected=!0,o.style("stroke-width","2px"),o.style("opacity",1),d3.select("#label"+o.data()[0].id).style("visibility","visible"),o.data()[0].showlabel=!0,showing_bundling?d3.selectAll("."+e.links[r].id).style("stroke","rgb(32,32,32)").style("stroke-opacity",.85):d3.select("#"+e.links[r].id).attr("stroke","rgba(32,32,32,"+selectedEdge+")"));else if(e.links[r].target.id===l.id){var o=d3.select("#"+e.links[r].source.id);o.data()[0].visible&&(o.data()[0].selected=!0,o.style("stroke-width","2px"),o.style("opacity",1),d3.select("#edge_"+e.links[r].source.id+"_"+e.links[r].target.id).attr("stroke","rgba(32,32,32,"+selectedEdge+")"),d3.select("#label"+o.data()[0].id).style("visibility","visible"),o.data()[0].showlabel=!0,showing_bundling?d3.selectAll("."+e.links[r].id).style("stroke","rgb(32,32,32)").style("stroke-opacity",.85):d3.select("#"+e.links[r].id).attr("stroke","rgba(32,32,32,"+selectedEdge+")"))}}else globalkeepEnabled?(d3.selectAll(".node").filter(function(e){return e.visible}).style("opacity",1).style("stroke-width","1px").style("stroke",function(e){return d3.rgb(scale(e.group)).darker()}),showing_bundling?d3.selectAll(".bundling").style("stroke","rgb(32,32,32)").style("stroke-opacity",unselectedEdgeDarker):d3.selectAll(".edge").attr("stroke","rgba(32,32,32,"+unselectedEdgeDarker+")")):(clear_visibility(!1),unselect_nodes(),remove_unused_organelles(),d3.selectAll(".group_component").classed("highlight_cc",!1)),is_force_running&&force.start();updateContentTable(e,l)}).call(a),r.append("text").text(function(e){return e.label}).attr("id",function(e){return"label"+e.id}).style("visibility","hidden").attr("pointer-events","none").attr("font-family","arial").attr("font-weight","bold").attr("stroke","white").attr("stroke-width",".1px").attr("font-size","11px").attr("class","node_label");force.nodes(e.nodes).links(e.links).on("tick",l).start(),globalnetwork=e;var o={0:function(e,t,l){return mapping_cytoplasm(e.x,e.y,t,l,Math.sqrt((e.x-l.cx)*(e.x-l.cx)+(e.y-l.cy)*(e.y-l.cy)))},1:function(e,t,l){return mapping_extracellular(e.x,e.y,t)},2:function(e,t,l){return mapping_walls(e.x,e.y,t[e.component],Math.sqrt((e.x-l.cx)*(e.x-l.cx)+(e.y-l.cy)*(e.y-l.cy)))},3:function(e,t,l){return mapping_organelles(e.x,e.y,l,Math.sqrt((e.x-l.cx)*(e.x-l.cx)+(e.y-l.cy)*(e.y-l.cy)))}}}function compute_network_measures(){null!==globalnetwork&&$.blockUI({message:"<h2>Computing network measures...</h2>",onBlock:function(){var e=new jsnx.Graph;e.addNodesFrom(range(0,globalnetwork.nodes.length)),degree=[];for(n=0;n<globalnetwork.nodes.length;n++)degree.push(0);for(n=0;n<globalnetwork.links.length;n++)e.addEdge(globalnetwork.links[n].source.index,globalnetwork.links[n].target.index),degree[globalnetwork.links[n].source.index]+=1,degree[globalnetwork.links[n].target.index]+=1;for(var t=jsnx.betweennessCentrality(e),l=jsnx.clustering(e),n=0;n<globalnetwork.nodes.length;n++){var a=globalnetwork.nodes[n];a.attributes["[betweenness]"]={type:"numeric",value:t._numberValues[n]},a.attributes["[clustering]"]={type:"numeric",value:l._numberValues[n]},a.attributes["[degree]"]={type:"numeric",value:degree[n]}}$(document).ready(function(){$("#color").append('<option value="[betweenness]">[betweenness]</option>')}),$(document).ready(function(){$("#change_label").append('<option value="[betweenness]">[betweenness]</option>')}),$(document).ready(function(){$("#color").append('<option value="[clustering]">[clustering]</option>')}),$(document).ready(function(){$("#color").append('<option value="[degree]">[degree]</option>')}),$(document).ready(function(){$("#change_label").append('<option value="[clustering]">[clustering]</option>')}),$(document).ready(function(){$("#change_label").append('<option value="[degree]">[degree]</option>')}),$.unblockUI()}})}function loadNetwork(e,t){if(alreadyHasANetwork=!0,error=!1,void 0!==t&&t)parseXGMML(e);else{var l=new FileReader;l.onload=function(e){parseXGMML(e.target.result),$("#loading-container").css("display","none")},error||l.readAsText(e)}}function parseXGMML(e){function t(){console.log("Querying Localization from InnateDB.");var e=[];if("innatedb reference"===g.toLowerCase())for(t=0;t<n.nodes.length;t++)e.push(n.nodes[t].attributes[g].value.split("?id=")[1].toString());else for(var t=0;t<n.nodes.length;t++)e.push(n.nodes[t].attributes[g].value.toString());var l="xref="+u+"&ids="+JSON.stringify(e).replace("[","").replace("]","").replace(/\"/g,"");console.log(l),$.ajax({dataType:"json",async:!1,type:"GET",url:"http://www.innatedb.com/cerebralLocalizationWS.do",data:l,success:function(t){for(var l=0;l<e.length;l++){n.nodes[l].attributes["Selected CC"]={type:"string",value:t[e[l]].toLowerCase()};var a=n.nodes[l].attributes["Selected CC"].value.replace(/ /g,"_");"cell_surface"==a?a="extracellular":a in cell&&""!==a&&null!==a||(a="cytoplasm"),n.nodes[l].group=n.nodes[l].attributes[d3.select("#color").node().value].value,n.nodes[l].component=a,n.nodes[l].component_id=get_component_id(a),(a=n.nodes[l].attributes["Selected CC"].value.replace(/ /g,"_"))in selected_cc_count?selected_cc_count[a]=selected_cc_count[a]+1:selected_cc_count[a]=1,used_organelles[a]=!0}},error:function(e,t,l){alert("Error in innateDB web service: http://www.innatedb.com/cerebralLocalizationWS.do. It is not possible to query Selected CC from this server."),console.log(l)}}),$("#color").append('<option value="Selected CC">Selected CC</option>'),$("#change_label").append('<option value="Selected CC">Selected CC</option>')}function l(){if(console.log("Missing cc: "+r),r){if(""==u)return alert("We could not query the Localization attribute from InnateDB since your network does not contain any of the attributes: UniProt, Ensembl, Entrez and InnateDB. Please consider reading the Help page for more information."),void resetGlobalVariables();t(),console.log("Selected CC attribute created.")}var l={};for(name in n.nodes[0].attributes)n.nodes[0].attributes.hasOwnProperty(name)&&(l[name]=1);var o="not_found",i={cellnetvis_ccs:1,cellular_component:2,"cellular_component_(go)":3,go_localizations:4};for(name in l)if(l.hasOwnProperty(name)){if((c=name.toLowerCase().replace(/ /g,"_"))in i){o=name;break}if(name.indexOf("components")>=0||name.indexOf("localizations")>=0){o=name;break}}if("not_found"==o)for(b=0;b<n.nodes.length;b++)n.nodes[b].attributes["CellNetVis CCs"]={type:"list",value:["not_found"]};else{var s=o,c=n.nodes[0].attributes[s].value,d=c.split(","),g=c.split(";"),p=";";d.length>g.length&&(p=",");for(var b=0;b<n.nodes.length;b++){for(var f=n.nodes[b].attributes[s].value.split(p),h=[],_=0;_<f.length;_++){var y=f[_].toLowerCase().replace(/ /g,"_");if("cytosol"==y||"cell_surface"==y)h.push(f[_]);else{var m=convertToCellNetVisCC(y);"not_found"!=m&&h.indexOf(m)<0&&h.push(m)}}n.nodes[b].attributes["CellNetVis CCs"]={type:"list",value:h}}}if(!a){used_organelles.plasma_membrane=!0,used_organelles.extracellular=!0,used_organelles.cytoplasm=!0,used_organelles.cytosol=!0,used_organelles.nucleus=!0,remove_unused_organelles();var v={cytoplasm:"",plasma_membrane:"",extracellular:"",cytosol:"",cell_wall:"",cell_surface:""};for(key in cell)key in v||(cytosol_keys[key]="");n.links=[],$(e).find("edge").each(function(){var e="n_"+$(this).attr("source").replace(/\./g,"_").replace(/\//g,"_"),t="n_"+$(this).attr("target").replace(/\./g,"_").replace(/\//g,"_");if(e!==t){var l=n.hash_ids[e],a=n.hash_ids[t],r={label:$(this).attr("label"),id:"edge_"+e+"_"+t,source:l,target:a,value:1};n.links.push(r)}}),constraint_network(n),createDonutChart(),updateNumbers(n),d3.select("#color").property("value","Selected CC"),d3.select("#change_label").property("value","Selected CC"),updateColor(),n.nodes.length>1e3||n.links.length>1e4?$("#alphaCollide").slider("disable"):$("#alphaCollide").slider("enable")}n=null,resetForces()}$("#cy2").empty(),d3.select("#cerebralDiv").style("visibility","hidden"),alreadyHasANetwork=!0;var n={};n.hash_ids={};var a=!1,r=!1;n.nodes=[],xmlDoc=$.parseXML(e),$xml=$(xmlDoc),$title=$xml.find("title");var o=[],i=[],s=0;$(e).find("node").each(function(){var e="n_"+$(this).attr("ID").replace(/\./g,"_").replace(/\//g,"_"),t=[];if(e in n.hash_ids)alert("XGMML redundant. There is more than one node with ID="+e);else{n.hash_ids[e]=s,s+=1;var l=$(this).attr("label");null!=l&&""!=l||(l=e.replace("n_",""));var a={};if($(this).find("att").each(function(){var e=$(this).attr("name"),l=e.toLowerCase();if("selected_cc"!==l&&"selected cc"!==l&&"localization"!==l||(e="Selected CC"),"list"!==$(this).attr("type").toLowerCase()){if("Selected CC"===e){r={type:$(this).attr("type"),value:$(this).attr("value").toLowerCase()};a[e]=r}else if(t.indexOf(e)<0){r={type:$(this).attr("type"),value:$(this).attr("value")};a[e]=r,t.push(e)}else{var n=[].concat(a[e].value).concat($(this).attr("value"));n=$.grep(n,function(e){return e});var r={type:$(this).attr("type"),value:n};a[e]=r}o.indexOf(e)<0&&(o.push(e),i.indexOf(e)<0&&$(document).ready(function(){$("#color").append('<option value="'+e+'">'+e+"</option>"),$("#change_label").append('<option value="'+e+'">'+e+"</option>")}))}else"Selected CC"!==e&&i.push(e)}),!r)if(o.indexOf("Selected CC")<0)r=!0;else{var c=a["Selected CC"].value.replace(/ /g,"_");"cell_surface"===c?c="extracellular":c in cell&&""!==c||(c="cytoplasm");u={id:e,name:l,label:l,showlabel:!1,selected:!1,sx:0,sy:0,visible:!0,attributes:a,group:a[d3.select("#color").node().value].value,component:c,component_id:get_component_id(c)};n.nodes.push(u);var d=a["Selected CC"].value.replace(/ /g,"_").toLowerCase();d in selected_cc_count?selected_cc_count[d]=selected_cc_count[d]+1:selected_cc_count[d]=1,used_organelles[d]=!0}if(r){a["Changed Selected CC"]={type:"boolean",value:!1};var u={id:e,name:l,label:l,showlabel:!1,selected:!1,sx:0,sy:0,visible:!0,attributes:a,group:null,component:null,component_id:null};n.nodes.push(u)}}resetForces()});var c=n.nodes[0],d=Object.keys(c.attributes),u="",g="";if(r)for(var p=0;p<d.length;p++){if(g=d[p],-1!==d[p].toLowerCase().indexOf("uniprot")){u="UniProt";break}if(-1!==d[p].toLowerCase().indexOf("ensembl")){u="Ensembl";break}if(-1!==d[p].toLowerCase().indexOf("entrez")){u="Entrez";break}if(-1!==d[p].toLowerCase().indexOf("innatedb")){u="InnateDB";break}}$("#submit_cc").click(function(){cc_picker="Innate DB",d3.select("#cc_question").style("display","none"),l()}),r?($("#color").append('<option value="Changed Selected CC">Changed Selected CC</option>'),$("#change_label").append('<option value="Changed Selected CC">Changed Selected CC</option>'),document.getElementById("popup-click").addEventListener("click",function(e){$("#selectCC").empty(),$.each(o,function(e,t){$("#selectCC").append($("<option/>",{value:t,text:t}))}),d3.select("#cc_question").style("display","block")}),document.getElementById("popup-click").click()):l()}function updateNodesGroup(e){var t=getAttributeValues(e);if(isNumericVector(t)){var l=Math.max.apply(Math,t),n=Math.min.apply(Math,t);n===l&&(l+=1),scale=d3.scale.quantize().domain([n,l]).range(coloring)}else t.length<11?"selected_cc"===e.toLowerCase()||"selected cc"===e.toLowerCase()?scale=d3.scale.category20():scale=d3.scale.category10().domain(t):"selected_cc"===e.toLowerCase()||"selected cc"===e.toLowerCase()?scale=d3.scale.category20():scale=d3.scale.category20().domain(t);d3.selectAll(".node").attr("group",function(t){return t.group=t.attributes[e].value,t.group}),d3.selectAll(".node").style("fill",function(e){return scale(e.group)}).style("stroke",function(e){return d3.rgb(scale(e.group)).darker()})}function isNumericVector(e){for(var t=0;t<e.length;t++)if(!1===$.isNumeric(e[t]))return!1;return!0}function getAttributeValues(e){for(var t=d3.selectAll(".node").data(),l=[],n=0;n<t.length;n++)l.indexOf(t[n].attributes[e].value)<0&&l.push(t[n].attributes[e].value);return l}function updateColor(){updateNodesGroup(d3.select("#color").node().value)}function showAllLabels(){for(var e=d3.selectAll(".node").filter(function(e){return e.visible}).data(),t=0;t<e.length;t++)e[t].showlabel=!0,d3.select("#label"+e[t].id).style("visibility","visible")}function hideAllLabels(){d3.selectAll(".node_label").style("visibility","hidden");for(var e=d3.selectAll(".node").data(),t=0;t<e.length;t++)e[t].showlabel=!1}function setLabels(e){var t=d3.selectAll(".node").data();for(nd in t)t[nd].label=t[nd].attributes[e].value}function updateDiagramLabels(){var e=d3.selectAll(".node").data();for(nd in e)d3.select("#label"+e[nd].id).text(e[nd].label)}function remove_unused_organelles(){for(var e in used_organelles)used_organelles.hasOwnProperty(e)&&(!1===used_organelles[e]?d3.select("#"+e+"_group").classed("removed",!0).style("visibility","hidden"):d3.select("#"+e+"_group").classed("removed",!1).style("visibility","visible"))}function updateNumbers(e){d3.select("#Nnodes").text(e.nodes.length+" nodes"),d3.select("#Nedges").text(e.links.length+" links")}function loadDiagram(e,t,l){d3.xml("circular_cell_structure.svg","image/svg+xml",function(n){var a=document.importNode(n.documentElement,!0);$(document).ready(function(){function e(){for(var e=d3.selectAll(".group_component")[0],t=0;t<e.length;t++){var n=e[t],a=n.getAttribute("transform");a=(a=(a=a.replace("translate(","")).replace(")","")).split(transform_svg_separator);var r=n.id.replace("_group",""),o=d3.select("#"+r)[0][0],i=parseFloat(o.getAttribute("cx"))+parseFloat(a[0])+l[0],s=parseFloat(o.getAttribute("cy"))+parseFloat(a[1])+l[1],c=parseFloat(o.getAttribute("r")),d=o.getAttribute("id");cellids[d]=t,!0!==used_organelles[d]&&(used_organelles[d]=!1),cell[d]={cx:i,cy:s,rmax:c,rmin:0,id:d}}cell.plasma_membrane.rmin=cell.cytoplasm.rmax+.6*delta,cell.cell_wall.rmin=cell.plasma_membrane.rmax+.6*delta}resetGlobalVariables(),d3.select("#chart").selectAll("*").remove(),d3.select("#chart").node().appendChild(a);var t=d3.selectAll("#cell_group")[0][0].getAttribute("transform");t=(t=(t=t.replace("translate(","")).replace(")","")).split(transform_svg_separator);for(var l=[parseFloat(t[0]),parseFloat(t[1])],n=(d3.select("#diagram").append("svg:g").attr("id","network_group").attr("transform","translate(0"+transform_svg_separator+"0)"),{cytoplasm_group:"",plasma_membrane_group:"",cell_wall_group:"",extracellular_group:""}),r=d3.selectAll(".group_component")[0],o=0;o<r.length;o++){var i=r[o];i.id in n||d3.select("#"+i.id).call(d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(){if(null===bundling){var t=d3.select("#"+this.id.replace("_group","")).node(),l=(cell[this.id.replace("_group","")],d3.event.x-t.getAttribute("cx")),n=d3.event.y-t.getAttribute("cy");d3.select(this).attr("transform","translate("+l+transform_svg_separator+n+")"),e(),force.start()}})).on("dragend",function(){force.stop(),force.start()})}e()}),null!==t&&null!==e&&t(e,l),$("#extracellular").click(unselect_nodes),$("#cytoplasm").click(unselect_nodes),$("#plasma_membrane").click(unselect_nodes),$("#cell_wall").click(unselect_nodes)})}function mapping_walls(e,t,l,n){return n>l.rmax-ddelta?{x:(l.rmax-ddelta)/n*(e-l.cx)+l.cx,y:(l.rmax-ddelta)/n*(t-l.cy)+l.cy}:n<l.rmin+ddelta?{x:(l.rmin+ddelta)/n*(e-l.cx)+l.cx,y:(l.rmin+ddelta)/n*(t-l.cy)+l.cy}:{x:e,y:t}}function mapping_organelles(e,t,l,n){return n>l.rmax-ddeltao?{x:(l.rmax-ddeltao)/n*(e-l.cx)+l.cx,y:(l.rmax-ddeltao)/n*(t-l.cy)+l.cy}:{x:e,y:t}}function mapping_cytoplasm(e,t,l,n,a){if(a>n.rmax-delta)return{x:(n.rmax-ddelta)/a*(e-n.cx)+n.cx,y:(n.rmax-ddelta)/a*(t-n.cy)+n.cy};for(key in cytosol_keys)if(n=l[key],!0===used_organelles[key]&&(a=Math.sqrt((e-n.cx)*(e-n.cx)+(t-n.cy)*(t-n.cy)))<n.rmax+ddelta)return{x:(n.rmax+ddelta)/a*(e-n.cx)+n.cx,y:(n.rmax+ddelta)/a*(t-n.cy)+n.cy};return{x:e,y:t}}function mapping_extracellular(e,t,l){var n=null;n=!0===used_organelles.cell_wall?l.cell_wall:l.plasma_membrane;var a=Math.sqrt((e-n.cx)*(e-n.cx)+(t-n.cy)*(t-n.cy));if(a<n.rmax+ddelta)return{x:(n.rmax+ddelta)/a*(e-n.cx)+n.cx,y:(n.rmax+ddelta)/a*(t-n.cy)+n.cy};var r=0,o=0;return r=e<ddelta?ddelta:e>w-ddelta?w-ddelta:e,o=t<ddelta?ddelta:t>h-ddelta?h-ddelta:t,{x:r,y:o}}function updateDonutChart(){$("#chart2 svg").empty(),createDonutChart()}function createDonutChart(){var e=[],t="";for(var l in selected_cc_count)selected_cc_count.hasOwnProperty(l)&&selected_cc_count[l]>0&&(""===l?e.push({label:"*undefined",value:selected_cc_count[l]}):(t=l.indexOf("endoplasmic_reticulum")>-1?"ER":l.indexOf("microtubule_organising_centre")>-1?"MTOC":l.replace(/_/g," ").toLowerCase().capitalize(),e.push({label:t,value:selected_cc_count[l]})));global_cc_data=e,allcc=[],global_cc_data.forEach(function(e){allcc.push(e.label)}),nv.addGraph(function(){var t=nv.models.pieChart().x(function(e){return e.label}).y(function(e){return e.value}).showLabels(!0).labelThreshold(.05).labelType("percent").donut(!0).donutRatio(.35);d3.select("#chart2 svg").datum(e).transition().duration(350).call(t);var l=0;e.forEach(function(e){l+=e.value});return t.tooltipContent(function(e,t,n,a){return'<h3 style="background-color: '+n.color+'">'+e+"</h3><p>"+parseInt(t)+"</p><p>"+(100*t/l).toFixed(2)+"%</p>"}),t})}function create_bundling(e){if(is_force_running)return alert("Can't compute edge bundling while Force algorithm is running. Please click on [Stop] button from Force section. After that, try computing the bundles again. After computing the bundling, you need to click on [Show]. To [Start] the force algorithm again you need to click on [Destroy] edge bundling."),null;alert("Edge bundling will be computed and may take some seconds or minutes. When it ends, a message will pop-up.");var t=null;d3.selectAll(".node").each(function(e){can_run_forces=!1,e.draggable=!1});for(var l={},n=(d3.selectAll(".node").each(function(e){l[e.index]={x:e.x,y:e.y}}),e.links),a=[],r=0;r<n.length;r++)n[r].source.visible&&n[r].target.visible&&a.push({source:n[r].source.index,target:n[r].target.index,id:n[r].id});$.blockUI({onBlock:function(){null!=(t=d3.ForceEdgeBundling().nodes(l).edges(a))&&$.unblockUI()},onUnblock:function(){bundling_data=t,bundling=bundling_data(),$("#hide_bundling").prop("disabled",!1),$("#show_edge_bundling").prop("disabled",!1),$("#remove_bundling").prop("disabled",!1),$("#restart_forces").prop("disabled",!0),alert("Edge bundling computed. Click [Show] on [Edge Bundling] menu to see the result.")}})}function draw_edge_bundling(e){if(null!==bundling){d3.selectAll(".edge").attr("visibility","hidden");var t=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),l=d3.select(".edges");d3.selectAll(".bundling").remove();for(var n=bundling_data.edges(),a=0;a<bundling.length;a++)l.append("path").attr("d",t(bundling[a])).style("stroke-width",1).style("stroke","rgb(32,32,32)").style("stroke-opacity",unselectedEdgeDarker).style("fill","none").attr("class","bundling "+n[a].id);d3.selectAll(".edge").each(function(e){d3.select("."+e.id).attr("visibility",e.source.visible&&e.target.visible?"visible":"hidden")}),showing_bundling=!0}else $("#show_edge_bundling").prop("disabled",!0)}function remove_edge_bundling(){null!==bundling&&(hide_edge_bundling(),d3.selectAll(".bundling").remove(),$("#hide_bundling").prop("disabled",!0),$("#show_edge_bundling").prop("disabled",!0),$("#remove_bundling").prop("disabled",!0),$("#restart_forces").prop("disabled",!1),can_run_forces=!0,d3.selectAll(".node").each(function(e){e.draggable=!0}),bundling=null)}function hide_edge_bundling(){null!==bundling?(d3.selectAll(".bundling").attr("visibility","hidden"),d3.selectAll(".edge").attr("visibility",function(e){return e.source.visible&&e.target.visible?"visible":"hidden"}),showing_bundling=!1):$("#hide_bundling").prop("disabled",!0)}function getParams(){for(var e,t={},l=document.URL.split("?").pop().split("&"),n=0;n<l.length;n++)t[(e=l[n].split("="))[0]]=e[1];return t}function integrate(){params=getParams();var e="";"file"in params&&(e=unescape(params.file),$("#loading-container").css("display","block"),$.ajax({url:e,type:"GET",cache:!1,dataType:"text",timeout:1e5,error:function(){alert("Error loading XGMML document")},success:function(e){handleFileIIS(e)},error:function(e){alert("Error loading file.")},complete:function(){$("#loading-container").css("display","none")}}))}function resetGlobalVariables(){cell={},used_organelles={},global_cc_data=null,allcc=[],selected_attribute="node.fillColor",selected_node=null,null!==globalnetwork&&(null!==globalnetwork.nodes&&(globalnetwork.nodes=null),null!==globalnetwork.links&&(globalnetwork.links=null),null!==globalnetwork.hash_ids&&(globalnetwork.hash_ids=null)),globalnetwork=null,globalkeepEnabled=!1,cellids={},cytosol_keys={},globalFile=null,is_force_running=!0,$("#color").empty(),null!==force&&(force.stop(),force.nodes(null),force.links(null),force=null),linkDistance=45,force=d3.layout.force().gravity(1e-6).charge(charge).linkDistance(linkDistance).linkStrength(linkStrength).size([w,h]),resetForces(),$("#hide_bundling").prop("disabled",!0),$("#show_edge_bundling").prop("disabled",!0),$("#remove_bundling").prop("disabled",!0),$("#restart_forces").prop("disabled",!1),is_force_running=!0,bundling=null,showing_bundling=!1,bundling_data=null,can_run_forces=!0,selected_cc_count={},$("#cy2").empty()}function getPicture(){var e=new XMLSerializer,t=document.getElementById("diagram");if(null!==t){var l=document.getElementById("figureformat"),n=l.options[l.selectedIndex].value,a=e.serializeToString(t),r=new Blob([a],{type:"image/svg+xml;charset="+document.characterSet}),o=document.getElementById("svg-name").value,i=null;if(i=null===o||""===o?"diagram"+n:o+n,".svg"===n)return saveAs(r,i),!1;if(".png"===n){var s=new Image;return s.src="data:image/svg+xml;base64,"+window.btoa(a),s.onload=function(){var e=document.createElement("canvas");e.width=5*s.width,e.height=5*s.height;var t=e.getContext("2d");t.scale(5,5),t.drawImage(s,0,0),t.globalCompositeOperation="destination-over",t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height);var l=document.createElement("a");l.download=i,l.href=e.toDataURL("image/png"),document.body.appendChild(l),l.click()},!1}}}function exportDonutChart(){var e=new XMLSerializer,t=document.querySelector("#donutchart");t.removeAttribute("xmlns"),t.removeAttribute("xmlns:xlink"),prefix="http://www.w3.org/2000/xmlns/",t.hasAttributeNS(prefix,"xmlns")||t.setAttributeNS(prefix,"xmlns","http://www.w3.org/2000/svg"),t.hasAttributeNS(prefix,"xmlns:xlink")||t.setAttributeNS(prefix,"xmlns:xlink","http://www.w3.org/1999/xlink");var l=t,n=d3.select("#donutchart"),a=d3.select("#donutchart").style("width"),r=d3.select("#donutchart").style("height");if(n.attr("width",a),n.attr("height",r),n.style("font-size","12px").style("font-family","Arial"),null!==l){var o=document.getElementById("donut_figureformat"),i=o.options[o.selectedIndex].value;d3.select("#donutchart").attr("width",300),d3.select("#donutchart").attr("height",350),".png"===i&&d3.select("#donutchart").style("width",null).style("height",null);var s=e.serializeToString(l),c=new Blob([s],{type:"image/svg+xml;charset="+document.characterSet}),d=(window.URL.createObjectURL(c),document.getElementById("donut-name").value),u=null;if(u=null===d||""===d?"cc-distribution"+i:d+i,".svg"===i)return saveAs(c,u),!1;if(".png"===i){var g=new Image;return g.src="data:image/svg+xml;base64,"+window.btoa(s),g.onload=function(){var e=document.createElement("canvas");e.width=5*g.width,e.height=5*g.height;var t=e.getContext("2d");t.scale(5,5),t.drawImage(g,0,0),t.globalCompositeOperation="destination-over",t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height);var l=document.createElement("a");l.download=u,l.href=e.toDataURL("image/png"),document.body.appendChild(l),l.click()},!1}return getPercents(global_cc_data,u)}}function getPercents(e,t){if(null!==e){var l=0;e.forEach(function(e){l+=e.value}),str="cellular component,count,percent\n",e.forEach(function(e){str=str+e.label+","+e.value+","+(e.value/l).toFixed(4)+"\n"}),saveAs(new Blob([str],{type:"text/plain;charset="+document.characterSet}),t)}return!1}function search(e){if(null!==globalnetwork){clear_visibility(!1);var t=d3.select("#exact").node().checked,l=d3.select(e).node().value.toUpperCase(),n=d3.selectAll(".node").data();showing_bundling?d3.selectAll(".bundling").style("stroke","rgb(32,32,32)").style("stroke-opacity",unselectedEdge):d3.selectAll(".edge").attr("stroke","rgba(32,32,32,"+unselectedEdge+")"),d3.selectAll(".node").style("opacity",.2);var a=l.split("\n"),r=[];for(nd in n)for(var o in a){if(null===a[o])break;if(t){if(n[nd].label.toUpperCase().valueOf()===a[o].toUpperCase().valueOf()){n[nd].selected=!0,n[nd].showlabel=!0,thisnode=d3.select("#"+n[nd].id),thisnode.style("stroke-width","2px").style("opacity",1),d3.select("#label"+n[nd].id).style("visibility","visible"),r.push(n[nd].id);break}}else if(n[nd].label.toUpperCase().search(a[o])>-1){n[nd].selected=!0,n[nd].showlabel=!0,thisnode=d3.select("#"+n[nd].id),thisnode.style("stroke-width","2px").style("opacity",1),d3.select("#label"+n[nd].id).style("visibility","visible"),r.push(n[nd].id);break}}selected_nodes_dic={};for(var i=0;i<r.length;i++)selected_nodes_dic[r[i]]="";for(var o in globalnetwork.links)globalnetwork.links[o].source.id in selected_nodes_dic&&globalnetwork.links[o].target.id in selected_nodes_dic&&(showing_bundling?d3.select("."+globalnetwork.links[o].id).style("stroke","rgb(32,32,32)").style("stroke-opacity",selectedEdge):d3.select("#"+globalnetwork.links[o].id).attr("stroke","rgba(32,32,32,"+selectedEdge+")"))}}function updateGraphVisibility(){d3.selectAll(".node").style("visibility",function(e){return e.visible?"visible":"hidden"}),showing_bundling?d3.selectAll(".edge").each(function(e){d3.select("."+e.id).attr("visibility",e.source.visible&&e.target.visible?"visible":"hidden")}):d3.selectAll(".edge").attr("visibility",function(e){return e.source.visible&&e.target.visible?"visible":"hidden"})}function keep(){globalkeepEnabled=!0;var e=d3.selectAll(".node").data();for(nd in e)e[nd].selected?e[nd].visible=!0:e[nd].visible=!1;updateGraphVisibility(),hideAllLabels(),showAllLabels(),force_only_selected()}function clear_visibility(e){if(null!==globalnetwork){globalkeepEnabled=!1;var t=d3.selectAll(".node").data();for(nd in t)t[nd].visible=!0,t[nd].selected=!1;d3.selectAll(".node").style("opacity",1).style("stroke-width","1px").style("stroke",function(e){return d3.rgb(scale(e.group)).darker()}),showing_bundling?d3.selectAll(".bundling").style("stroke","rgb(32,32,32)").style("stroke-opacity",.03):d3.selectAll(".edge").attr("stroke","rgba(32,32,32,"+unselectedEdgeDarker+")"),globalnetwork.nodes.length>1e3||globalnetwork.links.length>1e4?$("#alphaCollide").slider("disable"):$("#alphaCollide").slider("enable"),e&&(force.nodes(globalnetwork.nodes).links(globalnetwork.links).start(),restartForces()),d3.selectAll(".group_component").classed("highlight_cc",!1),hideAllLabels(),updateGraphVisibility()}}function unselect_nodes(){if(null!==globalnetwork){var e=d3.selectAll(".node").data();for(nd in e)1==e[nd].visible&&(e[nd].selected=!1);d3.selectAll(".node").style("opacity",1).style("stroke-width","1px").style("stroke",function(e){return d3.rgb(scale(e.group)).darker()}),showing_bundling?d3.selectAll(".bundling").style("stroke","rgb(32,32,32)").style("stroke-opacity",.03):d3.selectAll(".edge").attr("stroke","rgba(32,32,32,"+unselectedEdgeDarker+")"),globalnetwork.nodes.length>1e3||globalnetwork.links.length>1e4?$("#alphaCollide").slider("disable"):$("#alphaCollide").slider("enable"),d3.selectAll(".group_component").classed("highlight_cc",!1),hideAllLabels(),updateGraphVisibility()}}function force_only_selected(){if(null!==globalnetwork){newnodes=[];for(var e in globalnetwork.nodes)globalnetwork.nodes[e].selected&&newnodes.push(globalnetwork.nodes[e]);var t=[];for(var l in globalnetwork.links){var n=globalnetwork.links[l];n.source.selected&&n.target.selected&&t.push(n)}globalnetwork.nodes>1500&&globalnetwork.nodes<2e3?newnodes>100?$("#alphaCollide").slider("disable"):$("#alphaCollide").slider("enable"):globalnetwork.nodes>1e3&&newnodes>200?$("#alphaCollide").slider("disable"):$("#alphaCollide").slider("enable"),reset_force(newnodes,t)}}function changeAlpha(){globalAlpha=$("#alphaCollide").slider("getValue"),force.start()}function changeCharge(){force.charge($("#charge").slider("getValue")),force.start()}function changeStrength(){var e=$("#strength").slider("getValue");force.linkStrength(e),force.start()}function changeFriction(){force.friction($("#friction").slider("getValue")),force.start()}function resetForces(){null!==globalnetwork&&globalnetwork.nodes.length>300?($("#alphaCollide").slider("setValue",0),d3.select("#alphaLabel").text("0.0"),changeAlpha()):($("#alphaCollide").slider("setValue",.6),d3.select("#alphaLabel").text("0.6"),changeAlpha()),null!==globalnetwork&&globalnetwork.nodes.length>900?($("#charge").slider("setValue",-7),d3.select("#chargeLabel").text("-7"),changeCharge(),$("#friction").slider("setValue",.9),d3.select("#frictionLabel").text("0.9"),changeFriction()):($("#charge").slider("setValue",-63),d3.select("#chargeLabel").text("-63"),changeCharge(),$("#friction").slider("setValue",.7),d3.select("#frictionLabel").text("0.7"),changeFriction()),$("#strength").slider("setValue",.3),d3.select("#strengthLabel").text("0.3"),changeStrength()}function create_cerebral_layout(){if(null!=globalnetwork&&0!=globalnetwork.links.length){for(var e=globalnetwork.nodes,t=globalnetwork.links,l=[],n=0;n<e.length;n++){var a={};a.data={},a.data.id=e[n].id,a.data.name=e[n].label,a.data.color="#d1d1e0",a.data.localization=e[n].attributes["Selected CC"].value.capitalize(),a.group="nodes",l.push(a)}for(n=0;n<t.length;n++){var r={};r.data={},r.data.id=t[n].id,r.data.name="interaction",r.data.source=t[n].source.id,r.data.target=t[n].target.id,r.data.idgroup=t[n].id,r.group="edges",l.push(r)}for(var o={},n=0;n<e.length;n++){var i=e[n].attributes["Selected CC"].value;null!==i&&""!==i&&(o[i.capitalize()]=0)}for(var s=Object.keys(o),c={},n=0;n<s.length;n++)c[s[n]]="";var d=[];"Extracellular"in c&&d.push("Extracellular"),"Plasma Membrane"in c&&d.push("Plasma Membrane"),"Cytoplasm"in c&&d.push("Cytoplasm"),"Cytosol"in c&&d.push("Cytosol"),"Nucleus"in c&&d.push("Nucleus");for(n=0;n<s.length;n++)-1==d.indexOf(s[n])&&d.push(s[n]);options.layers=d,$("#cy2").empty(),$("#cy2").cytoscape({layout:options,showOverlay:!1,zoom:1,style:cerebral_style,elements:l,ready:function(){cy=this,cerebral_ready(cy)}}),d3.select("#cerebralDiv").style("visibility","visible")}else alert("There is no network loaded. Please, load a network.")}function changeLabels(){changeNodesLabels(d3.select("#change_label").node().value)}function changeNodesLabels(e){d3.selectAll(".node").each(function(t){t.label=t.attributes[e].value,d3.select("#label"+t.id).text(t.label)})}globalAlpha=0,cellids={},cell={},cytosol_keys={},globalnetwork=null,globalkeepEnabled=!1,unselectedEdge=.07,unselectedEdgeDarker=.2,selectedEdge=.5,globalFile=null,dragging=!1,is_force_running=!0,selected_cc_count={},cc_attribute_name=null,force=null,used_organelles={},global_cc_data=null,allcc=[],w=850,h=850,radius=5,padding=1,delta=2*radius,ddelta=2*radius,ddeltao=3*radius,scale=d3.scale.category10(),selected_attribute="Selected CC",coloring=["rgb(255,255,204)","rgb(255,237,160)","rgb(254,217,118)","rgb(254,178,76)","rgb(253,141,60)","rgb(252,78,42)","rgb(227,26,28)","rgb(189,0,38)","rgb(128,0,38)"],cc_picker=null,linkDistance=70,linkStrength=.3,charge=0,selected_node=null,G=new jsnx.Graph,bundling=null,bundling_data=null,is_force_runing=!0,can_run_forces=!0,showing_bundling=!1,transform_svg_separator=",",(/Edge\/12./i.test(navigator.userAgent)||/Edge\/13./i.test(navigator.userAgent)||/Edge\/14./i.test(navigator.userAgent)||/Edge\/15./i.test(navigator.userAgent)||/MSIE 10/i.test(navigator.userAgent)||/MSIE 11/i.test(navigator.userAgent)||/MSIE 12/i.test(navigator.userAgent)||/MSIE 13/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent))&&(transform_svg_separator=" "),main_components_ids={cytoplasm:0,extracellular:1,"cell surface":1,plasma_membrane:2,cell_wall:2},cytoplasm_id=main_components_ids.cytoplasm,extracellular_id=main_components_ids.extracellular,plasma_membrane_or_wall_id=main_components_ids.plasma_membrane,String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},force=d3.layout.force().gravity(1e-6).charge(charge).linkDistance(linkDistance).linkStrength(linkStrength).size([w,h]),$(document).ready(function(){loadDiagram(null,null,!1),d3.select("#donutchart_div").append("svg").attr("id","donutchart").style("width","300px").style("height","350px"),integrate(),$("#exact").click(function(){search("#search_text")}),$("#search_text")[0].oninput=function(){search("#search_text")},$("#find").click(function(){search("#search_text")}),$("#keep").click(keep),$("#clear").click(function(){clear_visibility(!0)}),$("#showlabels").click(showAllLabels),$("#hidelabels").click(hideAllLabels),$("#netmeas").click(compute_network_measures),$("#restart_forces").click(restartForces),$("#stop_forces").click(stopForces),$("#create_edge_bundling").click(function(){create_bundling(globalnetwork)}),$("#show_edge_bundling").click(function(){draw_edge_bundling(globalnetwork)}),$("#remove_bundling").click(remove_edge_bundling),$("#hide_bundling").click(hide_edge_bundling),$("#getpic").click(getPicture),$("#export_donut").click(exportDonutChart),document.getElementById("file").addEventListener("change",handleFileSelect,!1),$("#alphaCollideSlider").on("change",changeAlpha),$("#chargeSlider").on("change",changeCharge),$("#strengthSlider").on("change",changeStrength),$("#frictionSlider").on("change",changeFriction),$("#change_label").on("change",changeLabels),$("#create_cerebral").click(create_cerebral_layout),d3.select("#cerebralDiv").style("visibility","hidden"),$('input[type="checkbox"]').on("change",function(){$('input[name="'+this.name+'"]').not(this).prop("checked",!1)}),document.getElementById("cc_question").style.display="none"}),String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(e,t,l){return t+l.toUpperCase()})};